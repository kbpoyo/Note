### 生成HTTP请求消息

^b36798

#### 生成步骤
- **浏览器输入URL**
- **浏览器解析URL**
	- ![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052152924.png)
- **生成 HTTP 请求消息**
	- ![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052200623.png)

#### URL的各种格式
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052147066.png)

#### HTTP的主要方法
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052158443.png)

#### HTTP中的主要头字段

##### 适用于请求和响应消息的头字段

![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052204300.png)

##### 用于表示响应消息的附加信息的头字段

![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052209770.png)

##### 用于表示实体（消息体）的附加信息的头字段
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052210301.png)




#### HTTP状态码
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052202395.png)

#### 省略文件名

URL ： http://www.lab.glasscom.com/dir/
省略文件名时，服务器就会访问 */dir/index.html*或者 */dir/default.htm*

#### 注释
>[URL：Uniform Resource Locator，统一资源定位符](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=979fb425-006d-dc46-799d-b297dfa0d8f6&page=32&rect=82.369,144.802,276.085,156.430)
>[URI：Uniform Resource Identifier，统一资源标识符。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=b5ff9d87-19ec-79b6-a560-b451108bf346&page=38&rect=82.387,144.805,288.100,156.433)
>[FTP：File Transfer Protocol，文件传送协议。这是一种在上传、下载文件时使用的协议。使用 FTP 协议来传送文件的程序也被叫作 FTP](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=26fb9cf9-21f2-5705-3101-d0caea16156c&page=32&rect=82.315,89.560,374.162,114.436)


### 向DNS服务器查询Web服务器的IP地址

#### TCP/IP的基本思路
>TCP/IP 的结构如图 1.8 所示，就是由一些小的子网，通过路由器 A 连接起来组成一个大的网络。这里的子网可以理解为用集线器 B 连接起来的几台计算机 C，我们将它看作一个单位，称为子网。将子网通过路由器连接起来，就形成了一个网络 D。
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052214135.png)

#### IP地址的表示方法

![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052216502.png)

![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052217457.png)

![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052217684.png)

#### 域名和 IP 地址并用的理由

>- 使用 IP 地址只需要处理 4 字节的数字，而域名则需要处理几十个到 255 个字节的字符，这增加了路由器的负担，传送数据也会花费更长的时间D。
>- 域名并不仅是长，而且其长度是不固定的。处理长度不固定的数据比处理长度固定的数据要复杂，这也是造成效率低下的重要原因之一。

#### Socket 库提供查询 IP 地址的功能

>对于DNS 服务器，我们的计算机上
一定有相应的 DNS 客户端，而相当于 DNS 客户端的部分称为 DNS 解析
器，或者简称解析器。通过 DNS 查询 IP 地址的操作称为域名解析，因此
负责执行解析（resolution）这一操作的就叫解析器（resolver）了。
解析器实际上是一段程序，它包含在操作系统的 Socket 库中
发送消息这个操作并不是由解析器自身来执行，而是要委托给操作系统内部的协议栈  来执行。



#### 注释
>[一些家用路由器中已经内置了集线器功能，因此大家可以理解为这种路由器内部同时包含路由器和集线器两种设备，它们在里面已经连接起来了。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=12bacaae-0f5d-49b4-ea25-70dab506ffe8&page=52&rect=82.450,117.556,374.230,142.432)
>[DNS：Domain Name System，域名服务系统。将服务器名称和 IP 地址进行关联是 DNS 最常见的用法，但 DNS 的功能并不仅限于此，它还可以将邮件地址和邮件服务器进行关联，以及为各种信息关联相应的名称。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=47419516-5407-760e-bde7-ea844959882b&page=57&rect=71.048,61.553,362.837,100.433)
>[协议栈：操作系统内部的网络控制软件，也叫“协议驱动”“TCP/IP驱动”等。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=cae9bee7-cb38-08ad-4bef-1835cc344d05&page=61&rect=71.048,60.805,363.467,72.433)



### 全世界DNS服务器的大接力

#### DNS服务器的基本工作

- 来自客户端的查询消息包含以下 3 种信息
	- 域名
		- 服务器、邮件服务器（邮件地址中@后面的部分）的名称
	- Class
		- 在最早设计DNS 方案时，DNS 在互联网以外的其他网络中的应用也被考虑到了，而 Class 就是用来识别网络的信息。不过，如今除了互联网并没有其他的网络了，因此 Class 的值永远是代表互联网的IN
	- 记录类型
		- 表示域名对应何种类型的记录。例如，当类型为A时，表示域名
		    对应的是 IP 地址；当类型为MX时，表示域名对应的是邮件服务
			器。对于不同的记录类型，服务器向客户端返回的信息也会不同
		- 根据 IP 地址反查域名的 PTR类型
		- 查询域名相关别名的CNAME类型
		- 查询 DNS 服务器 IP 地址的 NS 类型
		- 查询域名属性信息的SOA 类型

**工作流程图**
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052224471.png)

#### 域名的层次结构

>在域名中，越靠右的
>位置表示其层级越高，比如www.lab.glasscom.com 这个域名如果按照公司
里的组织结构来说，大概就是“com 事业集团 glasscom 部 lab 科的www”
这样。其中，相当于一个层级的部分称为域。因此，com 域的下一层是
glasscom 域，再下一层是 lab 域，再下面才是www这个名字。

>一个域的信息是作为一个整体存
放在 DNS 服务器中的，不能将一个域拆开来存放在多台 DNS 服务器中。
>于是，DNS 服务器也具有了像域名一样的层次结构，每个域的信
息都存放在相应层级的DNS 服务器中。

>比如 www.nikkeibp.co.jp 这个域
名，最上层的 jp 代表分配给日本这个国家的域；下一层的 co 是日本国内
进行分类的域，代表公司；再下层的 nikkeibp 就是分配给某个公司的域；
最下层的www就是服务器的名称。

#### 寻找相应的 DNS服务器并获取 IP 地址

>负责管理 lab.glasscom.com 这个域的 DNS 服务器的 IP 地址需要注册到 glasscom.com 域的 DNS
服务器中，而 glasscom.com 域的 DNS 服务器的 IP 地址又需要注册到 com
域的 DNS 服务器中。这样，我们就可以通过上级 DNS 服务器查询出下级
DNS 服务器的 IP 地址，也就可以向下级DNS服务器发送查询请求了。

>在互联网中，com 和 jp 的上面还有一级域，称为根域。根域不像 com、jp 那样有自
己的名字，因此在一般书写域名时经常被省略，如果要明确表示根域，应
该像www.lab.glasscom.com. 这样在域名的最后再加上一个句点，而这个最
后的句点就代表根域。

>分配给根域 DNS 服务器
的 IP 地址在全世界仅有 13 个 A，而且这些地址几乎不发生变化，因此将这
些地址保存在所有的 DNS 服务器中也并不是一件难事。

**寻找流程**
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052233975.png)

#### 通过缓存加快 DNS服务器的响应

>现实中上级域和下级域有可能共享同一
台 DNS 服务器。在这种情况下，访问上级 DNS 服务器时就可以向下跳过
一级DNS服务器，直接返回再下一级 DNS服务器的相关信息。

>当要查询的域名不存在时，“不存在”这一响应结果也会被缓
存。这样，当下次查询这个不存在的域名时，也可以快速响应。

>DNS服务器中保存的信息都设置有一个有效期，当缓存中的信息超过有效期后，数
据就会从缓存中删除。

#### 注释

>[不仅是 Web 服务器，像邮件服务器、数据库服务器等，无论任何服务器，只要注册了A类型的记录，都可以作为服务器的域名来使用。准确来说，A类型的记录表示与 IP 地址所对应的域名，因此与其说是某个服务器的域名，不如说是被分配了某个 IP 地址的某台具体设备的域名。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=8ef0c6f5-bd7d-32d6-d408-f11e02da3eac&page=64&rect=82.585,64.924,378.685,117.808)
>[当一个邮件地址对应多个邮件服务器时，需要根据优先级来判断哪个邮件服务器是优先的。优先级数值较小的邮件服务器代表更优先。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=c3239b5c-8d9a-40d3-464f-ae7fc4d463d2&page=65&rect=71.174,61.557,362.922,86.433)
>A是 Address 的缩写。
>MX：Mail eXchange，邮件交换。
>[根域 DNS 服务器在运营上使用多台服务器来对应一个 IP 地址，因此尽管IP 地址只有 13 个，但其实服务器的数量是很多的。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=e56615c2-5903-068c-570e-b0133919a484&page=68&rect=82.567,60.849,374.158,85.725)


### 委托协议栈发送消息

>协议栈通过socket编程与server端进行TCP连接，传输报文段信息，发送HTTP请求信息，接收HTTP响应信息

**服务端与客户端通过socket连接**
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052236935.png)

**socket编程**
![](http://imgs.kbpoyo.top/imgs/网络是怎样连接的_202208052236539.png)

#### 注释

>[准确地说，IP 地址不是分配给每一台设备的，而是分配给设备中安装的网络硬件的。因此，如果一台设备中安装了多个网络硬件，那么就会有多个IP 地址。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=96c28b2e-6847-0fdb-2607-8044945ab1ad&page=77&rect=71.129,61.550,362.892,100.430)
>[根据应用种类不同，客户端和服务器哪一方先执行 close 都有可能。有些应用中是客户端先执行 close，而另外一些应用中则是服务器先执行 close。](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=43e2d5c4-85e1-269d-40a1-5debcf3f0c5a&page=80&rect=82.684,60.849,376.696,85.725)
>[地址解析协议（Address ResolutionProtocol，ARP）](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=77eb0a7d-3495-33bf-6b27-977c36fa1abc&page=83&rect=53.858,148.656,201.263,176.836)
>[ARP 是根据已知 IP 地址求出MAC地址这个答案，](obsidian://booknote?type=annotation&book=%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E9%93%BE%E6%8E%A5%E7%9A%84/%5B%E5%9B%BE%E7%81%B5%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%9B%E4%B9%A6%5D.%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84%E3%80%90neikuw.com%E3%80%91.pdf&id=f801614e-57ce-5645-1a9a-0edd66b04722&page=83&rect=215.426,318.652,362.828,346.832)
>
>

